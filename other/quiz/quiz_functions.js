const { Canvas, Image } = require('canvas');
const mergeImages = require('merge-images');
const {
  error,
  pokemonList,
  randomFromArray,
} = require('../../helpers.js');
const BSOD = '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';

// TODO: Update when new gen images added
const basePokemonIDs = [...new Set(pokemonList.map(p => Math.floor(p.id)))].filter(id => id <= 906);

const getRandomPokemon = () => {
  const baseID = randomFromArray(basePokemonIDs);
  return randomFromArray(pokemonList.filter(p => Math.floor(p.id) == baseID));
};

const getWhosThatPokemonImage = (pokemon) => new Promise((resolve) => {
  mergeImages([
    // Base image
    './assets/images/backdrop/whos_that_pokemon.png',
    { // pokemon image
      src: `./assets/images/pokemon/${pokemon.id}.png`,
      left: 12,
      top: 0,
      custom: (ctx, image) => {
        ctx.fillStyle = '#222';//GameConstants.TypeColor[pokemon.type[0]];
        ctx.fillRect(0, 0, image.width || image.img.width, image.height || image.img.height);
        ctx.globalCompositeOperation = 'destination-in';
      },
    },
  ], {
    Canvas,
    Image,
  }).then(b64 => resolve(b64.split(';base64,').pop()))
    .catch((e) => {
      error('Image not created for pokemon shadow:', pokemon, e);
      resolve(BSOD);
    });
});

const getWhosThatPokemonFinalImage = (pokemon, shiny) => new Promise((resolve) => {
  mergeImages([
    // Base image
    './assets/images/backdrop/whos_that_pokemon.png',
    { // pokemon image
      src: `./assets/images/${shiny ? 'shiny' : ''}pokemon/${pokemon.id}.png`,
      left: 12,
      top: 0,
    },
  ], {
    Canvas,
    Image,
  }).then(b64 => resolve(b64.split(';base64,').pop()))
    .catch((e) => {
      error(`Image not created for ${shiny ? 'shiny' : 'non shiny'} pokemon:`, pokemon, e);
      resolve(BSOD);
    });
});

module.exports = {
  getRandomPokemon,
  getWhosThatPokemonImage,
  getWhosThatPokemonFinalImage,
};
